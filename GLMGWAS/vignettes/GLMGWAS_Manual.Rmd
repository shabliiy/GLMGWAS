---
title: "GLMGWAS_Manual"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{GLMGWAS_Manual}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(GLMGWAS)
```

# Introduction

GLMGWAS is an R package designed for performing Genome-Wide Association Studies (GWAS) using a Generalized Linear Model (GLM) approach. It includes functionality for population structure correction through Principal Component Analysis (PCA) and automatically removes PCs that are linearly dependent on user-provided covariates.

# Installation

To install the package from GitHub, run the following command:

```{r}
if (!requireNamespace("devtools", quietly = TRUE)) install.packages("devtools")
devtools::install_github("shabliiy/GLMGWAS")
```

# Loading the Package

```{r}
library(GLMGWAS)
```

# Data Preparation

Ensure your data is formatted correctly:
- **Phenotype Data (`y`)**: A data frame containing the response variable.
- **Genotype Data (`X`)**: A matrix of SNP genotypes (individuals × SNPs).
- **Covariates (`C`)**: A data frame of covariates (individuals × covariates).

Example of loading data:

```{r}
library(data.table)

y <- fread("path/to/phenotype_data.txt")
X <- fread("path/to/genotype_data.txt")
X <- as.matrix(X[, -1])  # Remove taxa column
C <- fread("path/to/covariate_data.txt")
```

# Running PCA for Population Structure Correction

```{r}
PCs <- PCA_GWAS(X, C)
C_combined <- cbind(C, PCs)
```

# Performing GWAS

```{r}
p_values <- GLM_GWAS(y, X, C_combined)
```

# Saving and Viewing Results

```{r}
results <- data.frame(SNP = colnames(X), p_value = p_values)
fwrite(results, "GWAS_results.txt")
head(results[order(results$p_value), ])
```

# Method Comparison with GWASbyCor

To compare GLMGWAS with a competing method (GWASbyCor), use:

```{r}
p_values_gwasbycor <- apply(X, 2, function(snp) cor.test(y[[1]], snp)$p.value)

comparison <- data.frame(
  SNP = colnames(X),
  p_value_GLM = p_values,
  p_value_GWASbyCor = p_values_gwasbycor
)

boxplot(comparison$p_value_GLM, comparison$p_value_GWASbyCor,
        names = c("GLM_GWAS", "GWASbyCor"),
        main = "Comparison of GWAS Methods",
        ylab = "p-values", col = c("blue", "red"))
```

# Conclusion

This package provides a structured approach to GWAS while incorporating population structure correction. Contributions and improvements are welcome!

For more details, visit the [GitHub repository](https://github.com/shabliiy/GLMGWAS).
